<%- include ('header') %>

    <div class="container mt-5">

        <h1 id="titre"></h1>
        <div class="row">
            <div class="col-auto">
                <img id="image" />
                <p id="image-chargement"></p>
            </div>
            <div class="col">
                <p id="resume"></p>
                <a id="pageWikipedia" style="display: none;">More on wikipedia...</a>
            </div>
        </div>


        <h2 id="more" style="display: none;">Further information</h2>

        <div id="tableauScientifiques" style="max-height: 300px; overflow: scroll; display: none;">
            <table class="table table-bordered table-hover" id="scientifiques">
                <thead>
                    <tr>
                        <th>Scientists related to the concept</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <div id="tableauConcepts" style="max-height: 300px; overflow: scroll;display: none;">
            <table class="table table-bordered table-hover" id="concepts">
                <thead>
                    <tr>
                        <th>Other concepts related</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>


<script>
    <% if (locals.concept_name) { %>
        let domain = '<%= locals.concept_name %>';
        domain = domain.replace(/\(/g, "\\(").replace(/\)/g, "\\)").replace(/&#39;/g, "\\'").replace(/,/g, '\\,');;;

        rechercherTout("dbr:" + domain, "rdfs:label", null, function (response) {
            var titre = document.querySelector('#titre');
            var nomPage = document.querySelector("#nomPage");
            var element = (response.results.bindings.length>0) ? response.results.bindings.find(obj => obj.o["xml:lang"] === "en"): {"o":{"value" :"No name found"}};
            titre.innerHTML = nomPage.innerHTML = element.o.value;
        });
        rechercherTout("dbr:" + domain, "foaf:isPrimaryTopicOf", null, function (response) {
            if(response.results.bindings.length > 0){
                var lien = document.querySelector('#pageWikipedia');
                lien.setAttribute("href", response.results.bindings[0].o.value);
                lien.style.display = "block";
            }
            });
        rechercherTout("dbr:" + domain, "dbo:abstract", null, function (response) {
            var resume = document.querySelector('#resume');
            if(response.results.bindings.length > 0){
                var element = response.results.bindings.find(obj => obj.o["xml:lang"] === "en");
                 resume.innerHTML = element.o.value;
            }
            
        });
        afficherChargement($("#image-chargement"), "Chargement de l'image");
        rechercherTout("dbr:"+domain, "dbo:thumbnail", null, function(response){
        if(response.results.bindings != undefined && response.results.bindings.length > 0) {
            var image = document.querySelector('#image');
            image.setAttribute("src", response.results.bindings[0].o.value);
            $("#image-chargement").html('');
        }
        else {
            $("#image-chargement").html('No image found.');
        }
        });

        //rechercherInventeur("dbr:"+domain, "#scientifiques");

        
        rechercherInventeur("dbr:" + domain, function (response) {
            var input = response.results.bindings;
            var data = input.map(function(item) {
                return item.p.value.replace('http://dbpedia.org/resource/', '').replaceAll('_', ' ');
            });
            data = Array.from(new Set(data));
            if(data.length > 0){
                document.querySelector("#more").style.display = "block";
                document.querySelector("#tableauScientifiques").style.display = "block";
                // Récupérez l'élément <tbody>
                const tbody = document.querySelector('#scientifiques tbody');
                // Insérez les données dans le tableau
                for (const row of data) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    const a = document.createElement("a");
                    console.log(row);
                    a.href = "/scientist/" + row.replaceAll(' ', '_');
                    a.innerHTML = row;
                    td.appendChild(a);
                    tr.appendChild(td);
                    tbody.appendChild(tr);
                }
            }
            
        });
        

        rechercherTout("dbr:" + domain, "rdfs:seeAlso", null, function (response) {
            var input = response.results.bindings;
            var data = input.map(function (item) {
                return item.o.value.replace('http://dbpedia.org/resource/', '').replace('_', ' ');
            });
            if(data.length > 0){
                document.querySelector("#more").style.display = "block";
                document.querySelector("#tableauConcepts").style.display = "block";
                // Récupérez l'élément <tbody>
                const tbody = document.querySelector('#concepts tbody');
                // Insérez les données dans le tableau
                for (const row of data) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    const a = document.createElement("a");
                    a.href = "/concept/" + row.replace(' ', '_');
                    a.innerHTML = row;
                    td.appendChild(a);
                    tr.appendChild(td);
                    tbody.appendChild(tr);
                }
            }
            
        });
        
        
    <% } %>

</script>

<%- include ('footer') %>